name: Sync handbuch branch to public repo

on:
  push:
    branches:
      - Handbuch-mkdocs
  workflow_dispatch:

permissions:
  contents: write

jobs:
  push-handbuch:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Handbuch-mkdocs
        uses: actions/checkout@v4
        with:
          ref: Handbuch-mkdocs
          fetch-depth: 0

      - name: Configure git author
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

      - name: Add public remote
        env:
          PUBLIC_TOKEN: ${{ secrets.PAT_BIP_ORG_NEXT_EXAM }}
        run: |
          if [ -z "$PUBLIC_TOKEN" ]; then
            echo "PUBLIC_TOKEN is not set"; exit 1; 
          fi
          git remote remove public >/dev/null 2>&1 || true
          git remote add public "https://${PUBLIC_TOKEN}@github.com/Bildungsportal/next-exam.git"

      - name: Push to public handbuch
        env:
          PUBLIC_TOKEN: ${{ secrets.PAT_BIP_ORG_NEXT_EXAM }}
        run: |
          if [ -z "$PUBLIC_TOKEN" ]; then
            echo "PUBLIC_TOKEN is not set"; exit 1; 
          fi
          git push public Handbuch-mkdocs:handbuch